// Generated by CoffeeScript 1.3.3
(function() {
  var auth, config, qs, request, url;

  request = require('request');

  url = require('url');

  qs = require('querystring');

  config = require('config');

  auth = module.exports = {
    config: function(options) {
      this.options = options;
      return this;
    },
    getAuthUrl: function(scopes) {
      var uri;
      uri = config["authCodeUrl"];
      uri += '?client_id=' + this.options.id;
      if (scopes != null) {
        uri += '&scope=' + scopes.join(',');
      }
      return uri += '&response_type=code';
    },
    getAccessToken: function(code, callback) {
      return request({
        url: config["accessTokenUrl"],
        method: 'POST',
        body: qs.stringify({
          code: code,
          client_id: this.options.id,
          client_secret: this.options.secret,
          grant_type: 'authorization_code'
        }),
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        }
      }, function(err, res, body) {
        if (res.statusCode === 404) {
          return callback(new Error('Access token not found'));
        } else {
          body = qs.parse(body);
          if (body.error) {
            return callback(new Error(body.error));
          } else {
            return callback(null, body.access_token);
          }
        }
      });
    }
  };

}).call(this);
